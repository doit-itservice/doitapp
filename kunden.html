<html>
<body>

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>

<script>
var onSuccess = function(position){
	document.getElementById("karte").innerHTML = 'Latitude: '          + position.coords.latitude          + '<br>';
	document.getElementById("karte").innerHTML +=           'Longitude: '         + position.coords.longitude         + '<br>';
	document.getElementById("karte").innerHTML +=          'Altitude: '          + position.coords.altitude          + '<br>';
	document.getElementById("karte").innerHTML +=          'Accuracy: '          + position.coords.accuracy          + '<br>';
	document.getElementById("karte").innerHTML +=          'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '<br>';
	document.getElementById("karte").innerHTML +=          'Heading: '           + position.coords.heading           + '<br>';
	document.getElementById("karte").innerHTML +=          'Speed: '             + position.coords.speed             + '<br>';
	document.getElementById("karte").innerHTML +=          'Timestamp: '         + position.timestamp                + '<br>';
	
	var umkreis = window.localStorage.getItem("umkreis");
	if(umkreis < 1){umkreis = 250;}
	document.getElementById("ajaxreturn").innerHTML = "Suche Kunden...";
	Ajax_Kunden(position.coords.latitude, position.coords.longitude, umkreis);
};

function onError(error) {
	alert('Lokalisierung nicht moeglich\n' +
			'code: '    + error.code    + '\n' +
	        'message: ' + error.message + '\n');
}

function Ajax_Kunden(latitude, longitude, distance){
	var DOITserver = window.localStorage.getItem("DOITserver");
	var DOITuser = window.localStorage.getItem("DOITuser");
	var DOITauthcode = window.localStorage.getItem("DOITauthcode");

	$.ajax({
		url: DOITserver+"/ajax_kunden.php",
		data: {
			DOITuser: DOITuser,
			DOITauthcode: DOITauthcode,
			latitude: latitude,
			longitude: longitude,
			distance: distance
			  },
		datatype: "json",
		type: "POST",
		success: function(data) { Ajax_return_Kunden(data); }
	   });
}
		
function Ajax_return_Kunden(data){
	document.getElementById("ajaxreturn").innerHTML = data;
}

//url: "http://webserver/doitappserver/ajax_kunden.php",

function kundensuche(searchstring){
	if(searchstring.length > 4){
		var DOITserver = window.localStorage.getItem("DOITserver");
		var DOITuser = window.localStorage.getItem("DOITuser");
		var DOITauthcode = window.localStorage.getItem("DOITauthcode");
		$.ajax({
			url: DOITserver+"/ajax_kunden.php",
			data: {
				DOITuser: DOITuser,
				DOITauthcode: DOITauthcode,
				kundensuche: searchstring  
				},
			datatype: "json",
			type: "POST",
			success: function(data) { Ajax_return_Kunden(data); }
		   });
	}
}
</script>

<div align=center>
	<input type="button" onclick="navigator.geolocation.getCurrentPosition(onSuccess, onError,{ enableHighAccuracy: true });" value="Orte mich!">
</div>
<br>

<input type="text" name="kundensuche" placeholder="Kundenname" onkeyup="kundensuche(this.value);">

<div id="karte"></div>
<hr>
<div id="ajaxreturn"></div>
</body></html>